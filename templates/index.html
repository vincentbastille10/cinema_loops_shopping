<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cinema & Dance Audio Loops Shop ‚Äì WAV & MP3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description"
        content="Modern, cinematic and horror audio loops for films, dance, trailers and TikTok ‚Äì including Grey's Anatomy style and Stranger Things style moods. MP3 previews on this page and HD WAV files sent by email after purchase. Royalty-free audio for creators." />
  <meta name="robots" content="index,follow" />

  <style>
    :root {
      --bg: #050409;
      --bg-soft: #140712;
      --accent: #ff1744;
      --accent-soft: #ff4569;
      --accent-strong: #ff0022;
      --text: #fdfaff;
      --muted: #a0a0c5;
      --card-bg: #130710;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --glass: rgba(8, 4, 18, 0.80);
    }

    * { box-sizing: border-box; }

    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      color: var(--text);
      background-color: #050109;
      background-image:
        radial-gradient(circle at top, rgba(255, 23, 68, 0.32) 0, transparent 55%),
        radial-gradient(circle at bottom, rgba(0, 0, 0, 0.9) 0, #050109 60%);
      background-attachment: fixed;
      background-size: cover;
      background-repeat: no-repeat;
    }

    /* Si tu veux ton vrai fond:
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("{{ url_for('static', filename='cinema_loops_bg_red.jpg') }}");
      background-size: cover;
      background-position: center;
      opacity: 0.35;
      z-index: -1;
    }
    */

    a { color: inherit; text-decoration: none; }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 2.2rem 1.5rem 4rem;
    }

    /* TOP BAR */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-circle {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      background: conic-gradient(from 160deg, #ff1744, #ffea00, #ff6e40, #ff1744);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 18px rgba(255, 23, 68, 0.9),
        0 0 40px rgba(0, 0, 0, 0.8);
    }

    .logo-circle span {
      font-weight: 800;
      font-size: 1rem;
      color: #150102;
      letter-spacing: 0.08em;
    }

    .page-title-text h1 {
      font-size: 2rem;
      margin: 0;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 750;
    }

    .page-title-text p {
      margin: 0.3rem 0 0;
      color: var(--muted);
      font-size: 0.95rem;
      max-width: 540px;
    }

    .cart-widget {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(255, 23, 68, 0.8), rgba(15, 5, 20, 0.95));
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.8),
        0 0 10px rgba(255, 23, 68, 0.7);
      cursor: pointer;
      font-size: 0.85rem;
      position: relative;
      transform: translateY(0);
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .cart-widget:hover {
      transform: translateY(-1px);
      box-shadow:
        0 10px 22px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(255, 23, 68, 0.9);
    }

    .cart-widget.pulse {
      animation: cartPulse 0.55s ease-out;
    }

    @keyframes cartPulse {
      0%   { transform: translateY(0) scale(1); }
      35%  { transform: translateY(-1px) scale(1.04); box-shadow: 0 14px 26px rgba(0,0,0,1), 0 0 24px rgba(255,23,68,1); }
      100% { transform: translateY(0) scale(1); }
    }

    .cart-icon { font-size: 1.1rem; }

    .cart-label { display: flex; flex-direction: column; gap: 0.1rem; line-height: 1.1; }

    .cart-label span.main { font-weight: 600; font-size: 0.85rem; }

    .cart-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #000;
      color: #ffea00;
      border: 1px solid #ffea00;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
    }

    /* HERO */

    .hero-card {
      border-radius: 22px;
      padding: 1.4rem 1.4rem 1.3rem;
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top left, rgba(255, 23, 68, 0.45), rgba(5, 3, 10, 0.96));
      box-shadow:
        0 24px 80px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.03);
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 1.4rem;
      margin-bottom: 1.4rem;
      position: relative;
      overflow: hidden;
    }

    @media (max-width: 760px) {
      .hero-card { grid-template-columns: 1fr; }
    }

    .hero-main-title {
      font-size: 1.3rem;
      font-weight: 650;
      margin-bottom: 0.4rem;
    }

    .hero-subline {
      font-size: 0.95rem;
      color: #f8e8ef;
      margin-bottom: 0.7rem;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.85rem;
    }

    .hero-pill {
      padding: 0.22rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      background: rgba(5, 3, 12, 0.7);
      color: #ffeef7;
      font-size: 0.77rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .hero-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 99px;
      background: #ffea00;
      box-shadow: 0 0 8px rgba(255, 234, 0, 0.9);
    }

    .hero-note {
      font-size: 0.8rem;
      color: #ffe4f0;
      opacity: 0.85;
    }

    .hero-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: space-between;
      gap: 0.8rem;
    }

    .pack-banner {
      border-radius: 18px;
      padding: 0.9rem 1rem;
      background: linear-gradient(135deg, #000000, #240007);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 26px rgba(255, 23, 68, 0.6);
      text-align: right;
    }

    .pack-banner-title {
      font-size: 0.98rem;
      font-weight: 650;
      margin-bottom: 0.35rem;
    }

    .pack-banner-sub {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.45rem;
    }

    .pack-price-line {
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
      justify-content: flex-end;
      margin-bottom: 0.5rem;
    }

    .pack-price-main {
      font-size: 1.4rem;
      font-weight: 800;
      color: #ffea00;
    }

    .pack-price-tag {
      font-size: 0.8rem;
      padding: 0.12rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.28);
      background: rgba(10, 0, 0, 0.85);
      color: #ffcdd2;
    }

    .pack-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: linear-gradient(145deg, #ff1744, #ff6e40);
      color: #fff;
      font-size: 0.86rem;
      font-weight: 650;
      cursor: pointer;
      box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(255, 23, 68, 0.9);
      transform: translateY(0);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      text-decoration: none;
    }

    .pack-btn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 18px 38px rgba(0, 0, 0, 1),
        0 0 26px rgba(255, 23, 68, 1);
      background: linear-gradient(145deg, #ff4569, #ff8a65);
    }

    .pack-btn span.icon { font-size: 1.1rem; }

    .hero-footnote {
      font-size: 0.78rem;
      color: rgba(255, 220, 230, 0.9);
      text-align: right;
    }

    /* BADGES */

    .badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .badge-pill {
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(12, 6, 24, 0.8);
      color: var(--muted);
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      backdrop-filter: blur(8px);
    }

    .badge-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #37ff9f;
      box-shadow: 0 0 6px rgba(55, 255, 159, 0.9);
    }

    /* NAV CATEGORIES */

    .category-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 1.3rem 0 1.8rem;
    }

    .category-pill {
      display: inline-block;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      background: linear-gradient(145deg, #1a237e, #283593);
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow:
        0 8px 16px rgba(0, 0, 0, 0.6),
        0 0 14px rgba(41, 98, 255, 0.8);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    .category-pill:hover {
      background: linear-gradient(145deg, #303f9f, #3949ab);
      transform: translateY(-1px);
      box-shadow:
        0 10px 20px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(61, 128, 255, 1);
    }

    .category-pill.active {
      background: linear-gradient(145deg, #ff1744, #ff4569);
      box-shadow:
        0 10px 22px rgba(0, 0, 0, 1),
        0 0 26px rgba(255, 23, 68, 1);
    }

    /* ACCORDION */

    .accordion {
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(145deg, rgba(10, 4, 20, 0.96), rgba(6, 2, 16, 0.98));
      box-shadow:
        0 30px 80px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      overflow: hidden;
    }

    .accordion-item + .accordion-item {
      border-top: 1px solid rgba(255, 255, 255, 0.04);
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 1.2rem;
      cursor: pointer;
      background: radial-gradient(circle at top left, rgba(255, 23, 68, 0.16), transparent 60%);
      transition: background 0.2s ease;
    }

    .accordion-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cat-icon {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(255, 23, 68, 0.14);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }

    .cat-meta { display: flex; flex-direction: column; gap: 0.15rem; }

    .cat-title-line {
      display: flex;
      align-items: baseline;
      gap: 0.6rem;
    }

    .cat-title { font-size: 1rem; font-weight: 600; }

    .cat-tag {
      font-size: 0.72rem;
      padding: 0.08rem 0.5rem;
      border-radius: 99px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
    }

    .cat-desc {
      font-size: 0.78rem;
      color: var(--muted);
      max-width: 420px;
    }

    .accordion-header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .price-chip {
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      background: rgba(55, 255, 159, 0.08);
      border: 1px solid rgba(55, 255, 159, 0.5);
      color: #9dffcc;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .price-chip strong { font-size: 0.95rem; }

    .accordion-chevron {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      transition: transform 0.18s ease, background 0.18s ease;
    }

    .accordion-item.open .accordion-chevron {
      transform: rotate(90deg);
      background: rgba(255, 255, 255, 0.1);
    }

    .accordion-item.open .accordion-header {
      background: radial-gradient(circle at top left, rgba(255, 23, 68, 0.45), rgba(7, 3, 16, 0.96));
    }

    .accordion-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.22s ease-out;
      background: radial-gradient(circle at bottom right, rgba(40, 5, 20, 0.7), rgba(4, 2, 10, 1));
    }

    .accordion-item.open .accordion-panel { padding-bottom: 0.6rem; }

    .panel-inner { padding: 0 1.2rem 1rem; }

    .loop-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.65rem;
      margin-top: 0.5rem;
    }

    @media (min-width: 720px) {
      .loop-list { grid-template-columns: 1fr 1fr; }
    }

    .loop-item {
      position: relative;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.07);
      background: linear-gradient(145deg, rgba(12, 5, 18, 0.95), rgba(8, 3, 26, 0.95));
      padding: 0.6rem 0.65rem 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      box-shadow:
        0 8px 18px rgba(0, 0, 0, 0.85),
        0 0 10px rgba(0, 0, 0, 0.9);
    }

    .loop-row-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.4rem;
    }

    .loop-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: #fefaff;
      word-break: break-all;
    }

    .loop-meta {
      font-size: 0.7rem;
      color: var(--muted);
      text-align: right;
    }

    .loop-meta span.price {
      color: #9dffcc;
      font-weight: 600;
    }

    .loop-audio { margin-top: 0.25rem; }

    .loop-audio audio { width: 100%; }

    .buy-row {
      margin-top: 0.2rem;
      display: flex;
      justify-content: flex-end;
    }

    .buy-btn {
      font-size: 0.75rem;
      padding: 0.32rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: linear-gradient(145deg, #1a237e, #283593);
      color: #fdfaff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      box-shadow:
        0 8px 16px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(41, 98, 255, 0.9);
      transform: translateY(0);
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.12s ease;
    }

    .buy-btn:hover {
      background: linear-gradient(145deg, #303f9f, #3949ab);
      transform: translateY(-1px);
      box-shadow:
        0 12px 24px rgba(0, 0, 0, 1),
        0 0 18px rgba(61, 128, 255, 1);
    }

    .buy-btn span.icon { font-size: 0.85rem; }

    /* MINI TOAST */

    .mini-toast {
      position: absolute;
      right: 12px;
      bottom: 10px;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.9);
      color: #c8e6c9;
      font-size: 0.72rem;
      border: 1px solid rgba(200, 230, 201, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
      animation: miniToast 1.9s ease-out forwards;
      z-index: 5;
    }

    @keyframes miniToast {
      0%   { opacity: 0; transform: translateY(6px); }
      10%  { opacity: 1; transform: translateY(0); }
      85%  { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-4px); }
    }

    /* UNIVERSE & FOOTER */

    .universe-block {
      margin-top: 2.4rem;
      margin-bottom: 1.4rem;
      border-radius: 20px;
      padding: 1.1rem 1.3rem;
      background: radial-gradient(circle at left, rgba(41, 98, 255, 0.22), rgba(6, 4, 18, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.16);
      box-shadow:
        0 18px 42px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(41, 98, 255, 0.6);
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
    }

    .universe-text {
      font-size: 0.9rem;
      max-width: 480px;
    }

    .universe-text strong { font-weight: 650; }

    .universe-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.45rem 1rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: linear-gradient(145deg, #1a237e, #283593);
      color: #fff;
      font-size: 0.86rem;
      font-weight: 600;
      text-decoration: none;
      box-shadow:
        0 10px 24px rgba(0, 0, 0, 0.9),
        0 0 18px rgba(61, 128, 255, 0.9);
      transform: translateY(0);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .universe-btn:hover {
      background: linear-gradient(145deg, #303f9f, #3949ab);
      transform: translateY(-1px);
      box-shadow:
        0 14px 30px rgba(0, 0, 0, 1),
        0 0 24px rgba(61, 128, 255, 1);
    }

    .universe-btn span.icon { font-size: 1rem; }

    footer {
      margin-top: 2rem;
      font-size: 0.78rem;
      color: var(--muted);
      text-align: center;
      opacity: 0.85;
    }

    footer a {
      color: #90caf9;
      text-decoration: underline;
      text-decoration-thickness: 1px;
    }
  </style>
</head>

<body>
  <div class="page">

    <!-- TOP BAR -->
    <div class="top-bar">
      <div class="logo-title">
        <div class="logo-circle">
          <span>CL</span>
        </div>
        <div class="page-title-text">
          <h1>Cinema & Dance Audio Loops Shop</h1>
          <p>
            Modern, cinematic and horror loops for films, dance, trailers and TikTok ‚Äì
            including Grey's Anatomy style and Stranger Things style moods.
            MP3 previews here, HD WAV files sent by email after purchase.
          </p>
        </div>
      </div>

      <a href="{{ url_for('cart_page') }}" class="cart-widget" id="cartWidget">
        <div class="cart-badge" id="cartCount">0</div>
        <div class="cart-icon">üõí</div>
        <div class="cart-label">
          <span class="main">Cart</span>
          <span id="cartSummary">0 loops selected</span>
        </div>
      </a>
    </div>

    <!-- HERO / PACK BANNER -->
    <section class="hero-card">
      <div>
        <div class="hero-main-title">
          Curated packs for filmmakers, choreographers & content creators.
        </div>
        <div class="hero-subline">
          Preview everything in MP3, then get the full-quality WAV files in your inbox.
          All tracks are royalty-free for your projects.
        </div>

        <div class="hero-badges">
          <div class="hero-pill">
            <span class="dot"></span>
            48kHz WAV delivery by email
          </div>
          <div class="hero-pill">
            üé¨ Designed for cinema, series, trailers & dance pieces
          </div>
          <div class="hero-pill">
            üéß MP3 previews ‚Äì one loop at a time
          </div>
          <div class="hero-pill">
            ‚úÖ Royalty-free usage (see <a href="{{ url_for('about_page') }}">About</a>)
          </div>
        </div>

        <div class="hero-note">
          Explore by category, then buy single loops or grab the full pack.
        </div>
      </div>

      <div class="hero-right">
        <div class="pack-banner">
          <div class="pack-banner-title">
            Get the complete Cinema, Dance & Horror collection
          </div>
          <div class="pack-banner-sub">
            All Horror, Cinema, Drama, Grey‚Äôs Anatomy style and Stranger Things style loops in one bundle.
          </div>
          <div class="pack-price-line">
            <div class="pack-price-main">99‚Ç¨</div>
            <div class="pack-price-tag">Full pack</div>
          </div>
          <!-- Remplace par ton vrai lien Stripe pour le pack -->
          <a href="https://buy.stripe.com/your_full_pack_link_here"
             class="pack-btn">
            <span class="icon">üíæ</span>
            <span>Buy the full pack ‚Äì 99‚Ç¨</span>
          </a>
          <div class="hero-footnote">
            You receive a download email with all HD WAV files after payment.
          </div>
        </div>
      </div>
    </section>

    <!-- BADGES ROW -->
    <div class="badges-row">
      <div class="badge-pill">
        <span class="dot"></span> 48kHz WAV delivery | MP3 128kbps previews
      </div>
      <div class="badge-pill">
        üé¨ Cinema, contemporary dance, dramatic series
      </div>
      <div class="badge-pill">
        üéõÔ∏è Carefully mixed & tested in real shows
      </div>
      <div class="badge-pill">
        1‚Ç¨ per loop ‚Äì simple, transparent pricing
      </div>
      <div class="badge-pill">
        ‚úÖ Royalty-free for your projects (see <a href="{{ url_for('about_page') }}">About</a>)
      </div>
    </div>

    <!-- CATEGORY NAV -->
    <nav class="category-nav" id="categoryNav">
      <a href="#horror_short" class="category-pill">Horror</a>
      <a href="#horror_long" class="category-pill">Horror ‚Äì Long</a>
      <a href="#cinema_short" class="category-pill">Cinema</a>
      <a href="#cinematic_long" class="category-pill">Cinematic Long</a>
      <a href="#drama_long" class="category-pill">Drama</a>
      <a href="#greys_emotional" class="category-pill">Grey's Anatomy Style</a>
      <a href="#stranger_synth" class="category-pill">Stranger Things Synth</a>
    </nav>

    <!-- ACCORDION -->
    <section class="accordion" id="loopsAccordion">

      {% for category in categories %}
      <article id="{{ category.id }}" class="accordion-item">

        <div class="accordion-header accordion-toggle" data-category-id="{{ category.id }}">
          <div class="accordion-header-left">
            <div class="cat-icon">
              {% if 'horror' in category.id %}
                üëÅÔ∏è
              {% elif 'cinema' in category.id %}
                üé¨
              {% elif 'drama' in category.id %}
                üíî
              {% elif 'greys' in category.id %}
                ü©∫
              {% elif 'stranger' in category.id %}
                üïπÔ∏è
              {% else %}
                üéß
              {% endif %}
            </div>
            <div class="cat-meta">
              <div class="cat-title-line">
                <div class="cat-title">{{ category.title }}</div>
                <div class="cat-tag">{{ category.loops|length }} loops</div>
              </div>
              <div class="cat-desc">{{ category.description }}</div>
            </div>
          </div>
          <div class="accordion-header-right">
            <div class="price-chip">
              <span><strong>{{ category.loops[0].price_eur if category.loops else 1 }}‚Ç¨</strong> / loop</span>
            </div>
            <div class="accordion-chevron">&#9654;</div>
          </div>
        </div>

        <div class="accordion-panel">
          <div class="panel-inner">
            <div class="loop-list">

              {% for item in category.loops %}
              <div class="loop-item" data-loop-id="{{ item.id }}" data-loop-name="{{ item.name }}">
                <div class="loop-row-top">
                  <div class="loop-name">
                    {{ item.name }}
                  </div>
                  <div class="loop-meta">
                    <span class="price">{{ item.price_eur }}‚Ç¨</span> / WAV<br />
                    <span>MP3 preview ¬∑ 128k</span>
                  </div>
                </div>

                <div class="loop-audio">
                  <audio controls preload="none" class="loop-audio-player">
                    <source src="{{ item.preview }}" type="audio/mpeg" />
                    Your browser does not support HTML5 audio.
                  </audio>
                </div>

                <div class="buy-row">
                  <button class="buy-btn" type="button">
                    <span class="icon">üõí</span>
                    <span>Buy this loop ‚Äì {{ item.price_eur }}‚Ç¨</span>
                  </button>
                </div>
              </div>
              {% endfor %}

            </div>
          </div>
        </div>

      </article>
      {% endfor %}

    </section>

    <!-- UNIVERSE BLOCK -->
    <section class="universe-block">
      <div class="universe-text">
        <strong>Discover the extended Spectra Media universe.</strong><br />
        AI assistants, creative tools, film projects and more ‚Äì all connected to the same creative vision
        behind these loops.
      </div>
      <a href="https://group1-6y79.onrender.com/" class="universe-btn" target="_blank" rel="noopener">
        <span class="icon">üöÄ</span>
        <span>Explore Spectra Media universe</span>
      </a>
    </section>

    <!-- FOOTER -->
    <footer>
      <p>
        Cinema & Dance Loops ‚Äì composed and produced by Vincent Bastille.<br />
        All audio is delivered as HD WAV by email after purchase and is royalty-free for your projects
        (see <a href="{{ url_for('about_page') }}">About</a> for details).<br />
        For custom packs or original film music:
        <a href="mailto:vincentbastille100@gmail.com">vincentbastille100@gmail.com</a>
      </p>
    </footer>

  </div>

  <!-- SCRIPTS -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const accordionItems = document.querySelectorAll(".accordion-item");
      const navPills = document.querySelectorAll(".category-pill");
      const audioPlayers = document.querySelectorAll(".loop-audio-player");
      const cartCountEl = document.getElementById("cartCount");
      const cartSummaryEl = document.getElementById("cartSummary");
      const cartWidget = document.getElementById("cartWidget");

      const CART_KEY = "cinema_loops_cart_ids";

      // --- SINGLE AUDIO ---
      audioPlayers.forEach(player => {
        player.addEventListener("play", () => {
          audioPlayers.forEach(other => {
            if (other !== player) other.pause();
          });
        });
      });

      // --- ACCORDION ---
      function openItem(item) {
        accordionItems.forEach(it => {
          const panel = it.querySelector(".accordion-panel");
          if (it === item) {
            it.classList.add("open");
            if (panel) panel.style.maxHeight = panel.scrollHeight + "px";
          } else {
            it.classList.remove("open");
            if (panel) panel.style.maxHeight = 0;
          }
        });
      }

      function activatePillById(catId) {
        navPills.forEach(pill => {
          const href = pill.getAttribute("href") || "";
          if (href === "#" + catId) {
            pill.classList.add("active");
          } else {
            pill.classList.remove("active");
          }
        });
      }

      document.querySelectorAll(".accordion-toggle").forEach(toggle => {
        toggle.addEventListener("click", (e) => {
          const item = e.currentTarget.closest(".accordion-item");
          const isOpen = item.classList.contains("open");
          const panel = item.querySelector(".accordion-panel");
          const catId = item.getAttribute("id");

          if (isOpen) {
            item.classList.remove("open");
            if (panel) panel.style.maxHeight = 0;
          } else {
            openItem(item);
            activatePillById(catId);
            const rect = item.getBoundingClientRect();
            const y = rect.top + window.scrollY - 80;
            window.scrollTo({ top: y, behavior: "smooth" });
          }
        });
      });

      navPills.forEach(pill => {
        pill.addEventListener("click", (e) => {
          e.preventDefault();
          const href = pill.getAttribute("href");
          if (!href || !href.startsWith("#")) return;
          const targetId = href.substring(1);
          const targetItem = document.getElementById(targetId);
          if (targetItem) {
            openItem(targetItem);
            activatePillById(targetId);
            const rect = targetItem.getBoundingClientRect();
            const y = rect.top + window.scrollY - 80;
            window.scrollTo({ top: y, behavior: "smooth" });
          }
        });
      });

      if (accordionItems.length > 0) {
        const first = accordionItems[0];
        openItem(first);
        const firstId = first.getAttribute("id");
        activatePillById(firstId);
      }

      window.addEventListener("resize", () => {
        const openItemEl = document.querySelector(".accordion-item.open");
        if (openItemEl) {
          const panel = openItemEl.querySelector(".accordion-panel");
          if (panel) panel.style.maxHeight = panel.scrollHeight + "px";
        }
      });

      // --- CART STORAGE / BADGE ---

      function getCartIds() {
        try {
          const raw = localStorage.getItem(CART_KEY);
          const ids = raw ? JSON.parse(raw) : [];
          return Array.isArray(ids) ? ids : [];
        } catch (e) {
          return [];
        }
      }

      function setCartIds(ids) {
        try {
          localStorage.setItem(CART_KEY, JSON.stringify(ids));
        } catch (e) {
          // ignore
        }
      }

      function refreshCartBadge() {
        const ids = getCartIds();
        const count = ids.length;
        cartCountEl.textContent = count;
        cartSummaryEl.textContent =
          count === 0 ? "0 loops selected" :
          (count === 1 ? "1 loop selected" : count + " loops selected");
      }

      function pulseCart() {
        if (!cartWidget) return;
        cartWidget.classList.add("pulse");
        setTimeout(() => cartWidget.classList.remove("pulse"), 550);
      }

      function showMiniToast(loopItem, name) {
        if (!loopItem) return;
        const oldToast = loopItem.querySelector(".mini-toast");
        if (oldToast) oldToast.remove();

        const div = document.createElement("div");
        div.className = "mini-toast";
        div.innerHTML = `<span>‚úì</span><span>Added to cart</span>`;
        loopItem.appendChild(div);

        setTimeout(() => {
          if (div.parentNode) div.parentNode.removeChild(div);
        }, 1900);
      }

      function addToCart(loopId, loopName, loopItem) {
        const ids = getCartIds();
        if (!ids.includes(loopId)) {
          ids.push(loopId);
          setCartIds(ids);
          refreshCartBadge();
          showMiniToast(loopItem, loopName);
          pulseCart();
        } else {
          // d√©j√† pr√©sent -> petit toast quand m√™me
          showMiniToast(loopItem, loopName);
          pulseCart();
        }
      }

      refreshCartBadge();

      // --- BUY BUTTONS ---

      document.querySelectorAll(".loop-item").forEach(loopItem => {
        const btn = loopItem.querySelector(".buy-btn");
        if (!btn) return;
        btn.addEventListener("click", () => {
          const loopId = loopItem.getAttribute("data-loop-id");
          const loopName = loopItem.getAttribute("data-loop-name") || "";
          if (!loopId) return;
          addToCart(loopId, loopName, loopItem);
        });
      });
    });
  </script>

</body>
</html>
