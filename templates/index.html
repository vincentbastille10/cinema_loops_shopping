<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spectra Media Sounds ‚Äì Cinema & Dance Audio Loops Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050814;
      --bg-soft: #0c1022;
      --accent: #ff3366;
      --accent-soft: #ff5a88;
      --accent-strong: #ff9b4d;
      --text: #f8f8ff;
      --muted: #a0a4c0;
      --card-bg: #111428;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --pill-bg: rgba(255, 255, 255, 0.05);
      --pill-border: rgba(255, 255, 255, 0.16);
    }

    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: radial-gradient(circle at top, #261033 0, #050814 55%, #02030a 100%);
      color: var(--text);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* PAGE WRAPPER */

    .page {
      max-width: 1180px;
      margin: 0 auto;
      padding: 2.2rem 1.5rem 3.5rem;
      position: relative;
    }

    /* TOP CART BADGE */

    .cart-badge {
      position: fixed;
      top: 1.2rem;
      right: 1.5rem;
      z-index: 50;
    }

    .cart-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.55rem 1.1rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: radial-gradient(circle at top left, rgba(255,120,90,0.8), rgba(30,6,24,0.98));
      box-shadow: 0 10px 28px rgba(0,0,0,0.7);
      font-size: 0.85rem;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
    }

    .cart-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.85);
      background: radial-gradient(circle at top left, rgba(255,140,110,0.95), rgba(40,10,34,0.98));
    }

    .cart-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      background: rgba(0,0,0,0.18);
    }

    .cart-count {
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #ffcf4d;
      color: #1b1020;
      font-size: 0.78rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    /* HEADER / BRANDING */

    header.page-header {
      margin-bottom: 2rem;
    }

    .brand-stack {
      margin-bottom: 1.4rem;
    }

    .brand-main {
      font-size: 1rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.85);
    }

    .brand-subtitle {
      font-size: 2.3rem;
      margin: 0.35rem 0 0;
      letter-spacing: 0.03em;
    }

    .brand-tagline {
      margin: 0.75rem 0 0;
      color: var(--muted);
      max-width: 780px;
      font-size: 0.96rem;
      line-height: 1.55;
    }

    .brand-tagline a {
      color: #ffb764;
      text-decoration: underline;
      text-decoration-thickness: 1px;
    }

    /* HERO DOUBLE CARD */

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 1.3rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 900px) {
      .hero-grid {
        grid-template-columns: 1fr;
      }
    }

    .hero-card,
    .hero-pack-card {
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.08);
      background: radial-gradient(circle at top left, rgba(198,65,116,0.22), rgba(12,8,26,0.98));
      box-shadow: 0 30px 80px rgba(0,0,0,0.75);
      padding: 1.3rem 1.4rem 1.4rem;
    }

    .hero-pack-card {
      background: radial-gradient(circle at top right, rgba(255,150,80,0.39), rgba(12,6,18,0.98));
    }

    .hero-title {
      font-size: 1.15rem;
      margin: 0 0 0.4rem;
    }

    .hero-text {
      font-size: 0.9rem;
      margin: 0;
      color: var(--muted);
      line-height: 1.55;
    }

    .hero-badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-top: 0.8rem;
    }

    .pill {
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(7,8,20,0.85);
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--muted);
    }

    .pill .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #38ff9a;
      box-shadow: 0 0 8px rgba(56,255,154,0.9);
    }

    .hero-pack-price {
      margin-top: 1rem;
      display: flex;
      align-items: baseline;
      gap: 0.6rem;
    }

    .hero-pack-price-amount {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .hero-pack-price-label {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .hero-pack-cta {
      margin-top: 0.9rem;
    }

    .full-pack-btn {
      padding: 0.7rem 1.5rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff3366, #ff9c4f);
      color: #fff;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      box-shadow: 0 16px 40px rgba(0,0,0,0.8);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    .full-pack-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 55px rgba(0,0,0,0.95);
    }

    .hero-pack-note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    /* LOW HERO BADGES */

    .low-hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
      margin-bottom: 1.5rem;
    }

    .low-pill {
      padding: 0.25rem 0.8rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(7,8,20,0.95);
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--muted);
    }

    /* CATEGORY NAV */

    .category-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      margin-bottom: 1.4rem;
    }

    .category-pill {
      display: inline-block;
      padding: 0.4rem 0.95rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.18);
      color: #f8f8ff;
      font-size: 0.88rem;
      font-weight: 500;
      box-shadow: 0 6px 14px rgba(0,0,0,0.5);
      transition: background 0.12s ease, transform 0.08s ease, box-shadow 0.12s ease;
    }

    .category-pill:hover {
      background: rgba(255,255,255,0.13);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(0,0,0,0.65);
    }

    .category-pill.active {
      background: linear-gradient(135deg, #ff3366, #ff9c4f);
      box-shadow: 0 12px 26px rgba(0,0,0,0.8);
    }

    /* ACCORDION */

    .accordion {
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(145deg, rgba(10,8,28,0.96), rgba(4,5,18,0.98));
      box-shadow: 0 30px 90px rgba(0,0,0,0.85);
      overflow: hidden;
    }

    .accordion-item + .accordion-item {
      border-top: 1px solid rgba(255,255,255,0.07);
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 1.4rem;
      cursor: pointer;
      background: radial-gradient(circle at top left, rgba(255,80,120,0.18), transparent 60%);
      transition: background 0.2s ease;
    }

    .accordion-item.open .accordion-header {
      background: radial-gradient(circle at top left, rgba(255,80,140,0.35), rgba(6,5,18,1));
    }

    .accordion-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cat-icon {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .cat-meta {
      display: flex;
      flex-direction: column;
      gap: 0.18rem;
    }

    .cat-title-line {
      display: flex;
      align-items: baseline;
      gap: 0.6rem;
    }

    .cat-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .cat-tag {
      font-size: 0.74rem;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      background: rgba(0,0,0,0.4);
      color: #f3e1ff;
      border: 1px solid rgba(255,255,255,0.18);
    }

    .cat-desc {
      font-size: 0.82rem;
      color: var(--muted);
      max-width: 460px;
    }

    .accordion-header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.86rem;
      color: var(--muted);
    }

    .price-chip {
      padding: 0.23rem 0.8rem;
      border-radius: 999px;
      background: rgba(31, 209, 120, 0.12);
      border: 1px solid rgba(31, 209, 120, 0.8);
      color: #b4ffd7;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .accordion-chevron {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      transition: transform 0.18s ease, background 0.18s ease;
    }

    .accordion-item.open .accordion-chevron {
      transform: rotate(90deg);
      background: rgba(255,255,255,0.16);
    }

    .accordion-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.22s ease-out;
      background: radial-gradient(circle at bottom right, rgba(130,50,160,0.4), rgba(4,5,18,1));
    }

    .panel-inner {
      padding: 0 1.4rem 1.4rem;
    }

    .loop-list {
      margin-top: 0.6rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.7rem;
    }

    @media (max-width: 880px) {
      .loop-list {
        grid-template-columns: 1fr;
      }
    }

    .loop-item-card {
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(145deg, rgba(8,7,22,0.98), rgba(36,18,42,0.96));
      padding: 0.7rem 0.8rem 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      box-shadow: 0 16px 40px rgba(0,0,0,0.75);
    }

    .loop-top-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
    }

    .loop-name {
      font-size: 0.86rem;
      font-weight: 500;
    }

    .loop-meta {
      font-size: 0.8rem;
      color: var(--muted);
      text-align: right;
    }

    .loop-meta span.price {
      display: block;
      color: #b4ffd7;
      font-weight: 600;
    }

    .loop-audio {
      margin-top: 0.2rem;
    }

    .loop-audio audio {
      width: 100%;
    }

    .loop-actions {
      margin-top: 0.35rem;
      display: flex;
      justify-content: flex-end;
    }

    .buy-loop-btn {
      padding: 0.32rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      background: radial-gradient(circle at top left, rgba(255,51,102,0.85), rgba(130,32,82,0.9));
      color: #fff;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 10px 26px rgba(0,0,0,0.85);
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
    }

    .buy-loop-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(0,0,0,0.9);
      background: radial-gradient(circle at top left, rgba(255,80,130,0.95), rgba(150,40,90,0.95));
    }

    /* FOOTER */

    footer {
      margin-top: 2.7rem;
      font-size: 0.78rem;
      color: var(--muted);
      text-align: center;
      opacity: 0.8;
    }

    footer a {
      color: #ffb764;
      text-decoration: underline;
      text-decoration-thickness: 1px;
    }

    /* TOAST */

    .toast {
      position: fixed;
      bottom: 1.4rem;
      right: 1.4rem;
      padding: 0.6rem 0.9rem;
      border-radius: 12px;
      background: rgba(8, 14, 32, 0.96);
      border: 1px solid rgba(255,255,255,0.22);
      color: #f8f8ff;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 14px 34px rgba(0,0,0,0.9);
      z-index: 80;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.15s ease, transform 0.15s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast span.icon {
      font-size: 1rem;
    }
  </style>
</head>

<body>
  <div class="cart-badge">
    <button class="cart-button" type="button" id="cartButton">
      <div class="cart-icon">üõí</div>
      <div>
        <div style="font-size:0.8rem;">Cart</div>
        <div style="font-size:0.75rem;" id="cartLabel">0 loops selected</div>
      </div>
      <div class="cart-count" id="cartCount">0</div>
    </button>
  </div>

  <div class="page">
    <!-- HEADER / HERO -->
    <header class="page-header">
      <div class="brand-stack">
        <div class="brand-main">Spectra Media Sounds</div>
        <h1 class="brand-subtitle">Cinema &amp; Dance Audio Loops Shop</h1>
        <p class="brand-tagline">
          Modern, cinematic and horror loops for films, dance, trailers and TikTok ‚Äì
          including Grey's Anatomy style and Stranger Things style moods.
          MP3 previews on this page; HD WAV files are sent to you by email after purchase.
          Royalty-free usage for your projects (see
          <a href="{{ url_for('about_page') }}">About</a>).
        </p>
      </div>

      <div class="hero-grid">
        <!-- LEFT HERO CARD -->
        <div class="hero-card">
          <h2 class="hero-title">Curated packs for filmmakers, choreographers &amp; content creators.</h2>
          <p class="hero-text">
            Preview everything in MP3, then get the full-quality WAV files in your inbox.
            All tracks are designed for cinema, series, contemporary dance pieces, trailers
            and dramatic sequences.
          </p>
          <div class="hero-badges-row">
            <div class="pill">
              <span class="dot"></span> 48kHz WAV delivery by email
            </div>
            <div class="pill">
              üé¨ Cinema, contemporary dance, dramatic series
            </div>
            <div class="pill">
              üéß MP3 previews ‚Äì one loop at a time
            </div>
            <div class="pill">
              ‚úÖ Royalty-free for your projects
            </div>
          </div>
        </div>

        <!-- RIGHT FULL PACK CARD -->
        <aside class="hero-pack-card">
          <h2 class="hero-title">Get the complete Cinema, Dance &amp; Horror collection</h2>
          <p class="hero-text">
            All Horror, Cinema, Drama, Grey's Anatomy style and Stranger Things style loops
            combined in one bundle. Perfect if you want the full palette for your next film,
            choreography or TikTok series.
          </p>
          <div class="hero-pack-price">
            <div class="hero-pack-price-amount">99‚Ç¨</div>
            <div class="hero-pack-price-label">Full pack ‚Äì lifetime usage</div>
          </div>
          <div class="hero-pack-cta">
            <button class="full-pack-btn" type="button" id="fullPackBtn">
              <span>Buy the full pack ‚Äì 99‚Ç¨</span>
            </button>
          </div>
          <div class="hero-pack-note">
            You receive a download email with all HD WAV files after payment.
          </div>
        </aside>
      </div>
    </header>

    <!-- LOWER HERO BADGES -->
    <div class="low-hero-badges">
      <div class="low-pill">
        48kHz WAV delivery | MP3 128kbps previews
      </div>
      <div class="low-pill">
        Cinema, dance, contemporary drama, eerie moods
      </div>
      <div class="low-pill">
        1‚Ç¨ per loop ‚Äì simple, transparent pricing
      </div>
      <div class="low-pill">
        Royalty-free usage for your projects
      </div>
    </div>

    <!-- CATEGORY NAV -->
    <nav class="category-nav" id="categoryNav">
      <a href="#horror_short" class="category-pill">Horror</a>
      <a href="#horror_long" class="category-pill">Horror ‚Äì Long</a>
      <a href="#cinema_short" class="category-pill">Cinema</a>
      <a href="#cinematic_long" class="category-pill">Cinematic Long</a>
      <a href="#drama_long" class="category-pill">Drama</a>
      <a href="#greys_emotional" class="category-pill">Grey's Anatomy Style</a>
      <a href="#stranger_synth" class="category-pill">Stranger Things Synth</a>
    </nav>

    <!-- ACCORDION CATEGORIES -->
    <section class="accordion" id="loopsAccordion">
      {% for category in categories %}
      <article id="{{ category.id }}" class="accordion-item">
        <div class="accordion-header accordion-toggle" data-category-id="{{ category.id }}">
          <div class="accordion-header-left">
            <div class="cat-icon">
              {% if 'horror' in category.id %}
                üëÅÔ∏è
              {% elif 'cinema' in category.id %}
                üé¨
              {% elif 'drama' in category.id %}
                üíî
              {% elif 'grey' in category.id or 'greys' in category.id %}
                ü©∫
              {% elif 'stranger' in category.id %}
                üïπÔ∏è
              {% else %}
                üéß
              {% endif %}
            </div>
            <div class="cat-meta">
              <div class="cat-title-line">
                <div class="cat-title">{{ category.title }}</div>
                <div class="cat-tag">{{ category.loops|length }} loops</div>
              </div>
              <div class="cat-desc">{{ category.description }}</div>
            </div>
          </div>
          <div class="accordion-header-right">
            <div class="price-chip">
              1‚Ç¨ / loop
            </div>
            <div class="accordion-chevron">&#9654;</div>
          </div>
        </div>

        <div class="accordion-panel">
          <div class="panel-inner">
            <div class="loop-list">
              {% for track in category.loops %}
              <div class="loop-item-card">
                <div class="loop-top-row">
                  <div class="loop-name">
                    {{ track.name }}
                  </div>
                  <div class="loop-meta">
                    <span class="price">{{ track.price_eur }}‚Ç¨</span>
                    MP3 preview ¬∑ 128kb
                  </div>
                </div>
                <div class="loop-audio">
                  <audio controls preload="none" data-loop-id="{{ track.id }}">
                    <source src="{{ track.preview }}" type="audio/mpeg" />
                    Your browser does not support HTML5 audio.
                  </audio>
                </div>
                <div class="loop-actions">
                  <button class="buy-loop-btn"
                          type="button"
                          data-loop-id="{{ track.id }}">
                    <span>Buy this loop ‚Äì {{ track.price_eur }}‚Ç¨</span>
                  </button>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </article>
      {% endfor %}
    </section>

    <!-- FOOTER -->
    <footer>
      Cinema &amp; Dance Audio Loops ‚Äì composed and produced by Vincent Bastille (Spectra Media Sounds).<br />
      For custom packs or original film score, contact
      <a href="mailto:vincentbastille100@gmail.com">vincentbastille100@gmail.com</a>.
    </footer>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast">
    <span class="icon">‚úîÔ∏è</span>
    <span id="toastMessage">Loop added to cart.</span>
  </div>

  <script>
    // ---------------------------
    // CART & LOCALSTORAGE
    // ---------------------------
    const CART_KEY = "cinemaLoopsCart";

    function loadCartIds() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        return [];
      }
    }

    function saveCartIds(ids) {
      localStorage.setItem(CART_KEY, JSON.stringify(ids));
    }

    function updateCartBadge() {
      const ids = loadCartIds();
      const count = ids.length;
      const countEl = document.getElementById("cartCount");
      const labelEl = document.getElementById("cartLabel");
      if (countEl) countEl.textContent = count;
      if (labelEl) {
        labelEl.textContent = count === 1 ? "1 loop selected" : count + " loops selected";
      }
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      const msg = document.getElementById("toastMessage");
      if (!toast || !msg) return;
      msg.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 1800);
    }

    // ---------------------------
    // AUDIO ‚Äì ONE AT A TIME
    // ---------------------------
    function setupAudioPlayers() {
      const audios = Array.from(document.querySelectorAll("audio"));
      audios.forEach(a => {
        a.addEventListener("play", () => {
          audios.forEach(other => {
            if (other !== a && !other.paused) {
              other.pause();
            }
          });
        });
      });
    }

    // ---------------------------
    // ACCORDION & CATEGORY NAV
    // ---------------------------
    function setupAccordion() {
      const items = document.querySelectorAll(".accordion-item");
      const navPills = document.querySelectorAll(".category-pill");

      function openItem(item) {
        items.forEach(it => {
          const panel = it.querySelector(".accordion-panel");
          if (!panel) return;
          if (it === item) {
            it.classList.add("open");
            panel.style.maxHeight = panel.scrollHeight + "px";
          } else {
            it.classList.remove("open");
            panel.style.maxHeight = 0;
          }
        });
      }

      function activatePillById(catId) {
        navPills.forEach(pill => {
          const href = pill.getAttribute("href") || "";
          if (href === "#" + catId) {
            pill.classList.add("active");
          } else {
            pill.classList.remove("active");
          }
        });
      }

      document.querySelectorAll(".accordion-toggle").forEach(toggle => {
        toggle.addEventListener("click", (e) => {
          const item = e.currentTarget.closest(".accordion-item");
          if (!item) return;
          const panel = item.querySelector(".accordion-panel");
          if (!panel) return;

          if (item.classList.contains("open")) {
            item.classList.remove("open");
            panel.style.maxHeight = 0;
          } else {
            openItem(item);
            const id = item.getAttribute("id");
            if (id) activatePillById(id);
            const rect = item.getBoundingClientRect();
            const y = rect.top + window.scrollY - 80;
            window.scrollTo({ top: y, behavior: "smooth" });
          }
        });
      });

      navPills.forEach(pill => {
        pill.addEventListener("click", (e) => {
          e.preventDefault();
          const href = pill.getAttribute("href") || "";
          if (!href.startsWith("#")) return;
          const id = href.substring(1);
          const target = document.getElementById(id);
          if (!target) return;
          openItem(target);
          activatePillById(id);
          const rect = target.getBoundingClientRect();
          const y = rect.top + window.scrollY - 80;
          window.scrollTo({ top: y, behavior: "smooth" });
        });
      });

      // Open first category by default
      if (items.length > 0) {
        const first = items[0];
        openItem(first);
        const firstId = first.getAttribute("id");
        if (firstId) activatePillById(firstId);
      }

      // Recompute height on resize
      window.addEventListener("resize", () => {
        const openItemEl = document.querySelector(".accordion-item.open");
        if (!openItemEl) return;
        const panel = openItemEl.querySelector(".accordion-panel");
        if (!panel) return;
        panel.style.maxHeight = panel.scrollHeight + "px";
      });
    }

    // ---------------------------
    // LOOP BUTTONS & CART LOGIC
    // ---------------------------
    function setupLoopButtons() {
      const buttons = document.querySelectorAll(".buy-loop-btn");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-loop-id");
          if (!id) return;
          const ids = loadCartIds();
          if (!ids.includes(id)) {
            ids.push(id);
            saveCartIds(ids);
            updateCartBadge();
            showToast("Loop added to cart.");
          } else {
            showToast("This loop is already in your cart.");
          }
        });
      });
    }

    function setupCartButton() {
      const btn = document.getElementById("cartButton");
      if (!btn) return;
      btn.addEventListener("click", () => {
        window.location.href = "{{ url_for('cart_page') }}";
      });
    }

    function setupFullPackButton() {
      const btn = document.getElementById("fullPackBtn");
      if (!btn) return;
      btn.addEventListener("click", () => {
        // Pour l'instant : redirige simplement vers la page "Contact / About" ou mail.
        window.location.href = "mailto:vincentbastille100@gmail.com?subject=Buy%20full%20Cinema%20%26%20Dance%20Loops%20pack%20(99‚Ç¨)";
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      setupAudioPlayers();
      setupAccordion();
      setupLoopButtons();
      setupCartButton();
      setupFullPackButton();
      updateCartBadge();
    });
  </script>
</body>
</html>
