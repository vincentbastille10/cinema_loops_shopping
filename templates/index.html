<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Spectra Media Sounds ‚Äì Cinema & Dance Audio Loops Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description"
        content="Modern cinema & dance audio loops for films, choreography, trailers and TikTok ‚Äì including horror, Grey's Anatomy style and Stranger Things synth moods. MP3 previews on this page, HD WAV files sent by email after purchase." />
  <meta name="robots" content="index,follow" />

  <style>
    :root {
      --bg: #05030b;
      --bg-soft: #120818;
      --bg-hero: radial-gradient(circle at top left, #2b0f2f 0, #05030b 55%, #02010a 100%);
      --accent: #ff3b82;
      --accent-soft: #ff6b9e;
      --accent-strong: #ff205f;
      --accent-yellow: #ffc857;
      --accent-green: #23d18b;
      --text: #fdf7ff;
      --muted: #b8a8c8;
      --card-bg: #150716;
      --card-bg-soft: rgba(16, 4, 25, 0.9);
      --border-subtle: rgba(255, 255, 255, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", sans-serif;
      background: var(--bg-hero);
      color: var(--text);
      min-height: 100vh;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page {
      max-width: 1160px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
    }

    /* TOP HEADER / BRAND */

    header.main-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .brand-block {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .brand-logo {
      width: 56px;
      height: 56px;
      border-radius: 18px;
      background:
        radial-gradient(circle at 20% 20%, #ffd86b 0, #ff9b4b 32%, transparent 60%),
        radial-gradient(circle at 80% 80%, #ff4b8b 0, #b51872 40%, transparent 70%);
      box-shadow:
        0 0 25px rgba(255, 59, 130, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brand-logo span {
      font-weight: 800;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
      color: #1b021b;
    }

    .brand-text h1 {
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #ffffff;
    }

    .brand-text h2 {
      margin: 0.25rem 0 0;
      font-size: 1.1rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--accent-soft);
    }

    .brand-text p {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: var(--muted);
      max-width: 620px;
    }

    /* CART PILL */

    .cart-pill {
      border-radius: 999px;
      padding: 0.4rem 0.9rem 0.4rem 0.75rem;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.7));
      border: 1px solid rgba(255, 255, 255, 0.22);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.82rem;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      position: relative;
    }

    .cart-icon {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: linear-gradient(145deg, #ff6b9e, #ffb449);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: #2a0215;
    }

    .cart-label {
      display: flex;
      flex-direction: column;
      gap: 0.05rem;
    }

    .cart-label span.line1 {
      font-weight: 600;
    }

    .cart-label span.line2 {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .cart-count-badge {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #ff205f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      box-shadow: 0 0 0 2px #05030b;
    }

    /* HERO CARD */

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 1.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1.8rem;
    }

    @media (max-width: 900px) {
      .hero-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      header.main-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .cart-pill {
        align-self: flex-end;
      }
    }

    .hero-main,
    .hero-pack {
      border-radius: 24px;
      padding: 1.4rem 1.6rem;
      background: radial-gradient(circle at top left, rgba(255, 92, 159, 0.12), rgba(8, 2, 18, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 28px 90px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.06);
      position: relative;
      overflow: hidden;
    }

    .hero-pack {
      background:
        radial-gradient(circle at top right, rgba(255, 200, 87, 0.12), rgba(16, 3, 25, 0.98));
    }

    .hero-main h3 {
      margin: 0 0 0.35rem;
      font-size: 1.1rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #ffffff;
    }

    .hero-main h4 {
      margin: 0 0 0.9rem;
      font-size: 1.05rem;
      font-weight: 500;
      color: var(--accent-yellow);
    }

    .hero-main p {
      margin: 0 0 0.75rem;
      font-size: 0.9rem;
      color: var(--muted);
      max-width: 620px;
    }

    .hero-tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 0.6rem;
    }

    .hero-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      padding: 0.28rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 5, 33, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.16);
      color: var(--muted);
    }

    .hero-tag span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-green);
      box-shadow: 0 0 8px rgba(35, 209, 139, 0.9);
    }

    .hero-tag strong {
      color: #fefefe;
      font-weight: 600;
    }

    .hero-pack h3 {
      margin: 0 0 0.5rem;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .hero-pack p {
      margin: 0.15rem 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .hero-pack .price-line {
      margin-top: 0.8rem;
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
    }

    .hero-pack .price-line span.label {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--muted);
    }

    .full-pack-btn {
      margin-top: 1.2rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #ff6b9e, #ffc857);
      color: #2a0215;
      font-size: 0.95rem;
      font-weight: 700;
      box-shadow:
        0 10px 35px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .full-pack-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.95);
    }

    .full-pack-btn span.icon {
      font-size: 1rem;
    }

    .hero-pack-footer {
      margin-top: 0.8rem;
      font-size: 0.78rem;
      color: var(--muted);
    }

    /* MAIN INFO STRIP */

    .info-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1.5rem;
    }

    .info-pill {
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(12, 4, 26, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.16);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: var(--muted);
    }

    .info-pill strong {
      color: #fdfdfd;
      font-weight: 600;
    }

    /* CATEGORY NAV */

    .category-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 0 0 1.5rem;
    }

    .category-pill {
      display: inline-block;
      padding: 0.45rem 0.95rem;
      border-radius: 999px;
      background: rgba(30, 10, 40, 0.9);
      color: #ffffff;
      font-size: 0.87rem;
      font-weight: 500;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.16);
      transition: transform 0.12s ease, background 0.12s ease, box-shadow 0.12s ease;
    }

    .category-pill:hover {
      transform: translateY(-1px);
      background: rgba(50, 15, 70, 0.98);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.75);
    }

    .category-pill.active {
      background: linear-gradient(135deg, #ff3b82, #ff9b4b);
      color: #1b021b;
      border-color: transparent;
      box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.08),
        0 16px 36px rgba(0, 0, 0, 0.9);
    }

    /* ACCORDION CATEGORIES */

    .accordion {
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: radial-gradient(circle at top left, rgba(110, 22, 85, 0.28), rgba(8, 1, 18, 0.98));
      box-shadow:
        0 32px 90px rgba(0, 0, 0, 0.95),
        0 0 0 1px rgba(255, 255, 255, 0.03);
      overflow: hidden;
    }

    .accordion-item + .accordion-item {
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 1.4rem;
      cursor: pointer;
      background: linear-gradient(90deg, rgba(50, 6, 25, 0.8), rgba(10, 2, 18, 0.96));
      transition: background 0.18s ease;
    }

    .accordion-item.open .accordion-header {
      background: linear-gradient(90deg, rgba(120, 20, 80, 0.96), rgba(20, 4, 44, 0.98));
    }

    .accordion-header-left {
      display: flex;
      align-items: center;
      gap: 0.9rem;
    }

    .cat-icon {
      width: 38px;
      height: 38px;
      border-radius: 16px;
      background: radial-gradient(circle at 30% 20%, #ff6b9e 0, #3c041b 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .cat-meta {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .cat-title-line {
      display: flex;
      align-items: baseline;
      gap: 0.6rem;
    }

    .cat-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .cat-tag {
      font-size: 0.74rem;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
    }

    .cat-desc {
      font-size: 0.8rem;
      color: var(--muted);
      max-width: 430px;
    }

    .accordion-header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .price-chip {
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      background: rgba(35, 209, 139, 0.08);
      border: 1px solid rgba(35, 209, 139, 0.6);
      color: #93ffd1;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .price-chip strong {
      font-size: 0.95rem;
    }

    .accordion-chevron {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      transition: transform 0.18s ease, background 0.18s ease;
    }

    .accordion-item.open .accordion-chevron {
      transform: rotate(90deg);
      background: rgba(255, 255, 255, 0.12);
    }

    .accordion-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.22s ease-out;
      background: radial-gradient(circle at bottom right, rgba(18, 4, 44, 0.9), #05030b);
    }

    .accordion-item.open .accordion-panel {
      padding-bottom: 0.6rem;
    }

    .panel-inner {
      padding: 0 1.4rem 1.2rem;
    }

    .loop-list {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 0.75rem;
      margin-top: 0.6rem;
    }

    @media (min-width: 860px) {
      .loop-list {
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      }
    }

    .loop-item {
      border-radius: 18px;
      padding: 0.8rem 0.9rem 0.9rem;
      background: linear-gradient(135deg, rgba(22, 4, 45, 0.96), rgba(8, 3, 18, 0.98));
      border: 1px solid rgba(255, 255, 255, 0.14);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      gap: 0.32rem;
    }

    .loop-row-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
    }

    .loop-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: #ffffff;
      word-break: break-word;
    }

    .loop-meta {
      font-size: 0.76rem;
      text-align: right;
      color: var(--muted);
    }

    .loop-meta span.price {
      color: #93ffd1;
      font-weight: 600;
    }

    .loop-audio {
      margin-top: 0.2rem;
    }

    .loop-audio audio {
      width: 100%;
    }

    .buy-row {
      margin-top: 0.2rem;
      display: flex;
      justify-content: flex-end;
    }

    .buy-btn {
      font-size: 0.8rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: radial-gradient(circle at top left, rgba(255, 59, 130, 0.9), rgba(110, 20, 80, 0.96));
      color: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.85);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .buy-btn span.icon {
      font-size: 0.9rem;
    }

    .buy-btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.9);
    }

    /* TOAST / NOTIFICATIONS */

    .toast {
      position: fixed;
      right: 1.2rem;
      bottom: 1.2rem;
      max-width: 260px;
      padding: 0.7rem 1rem;
      border-radius: 14px;
      background: rgba(8, 2, 20, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: var(--text);
      font-size: 0.82rem;
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.9);
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
      transition: opacity 0.16s ease, transform 0.16s ease;
      z-index: 40;
    }

    .toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .toast span.highlight {
      color: var(--accent-soft);
      font-weight: 600;
    }

    /* FOOTER */

    footer {
      margin-top: 2.5rem;
      font-size: 0.8rem;
      color: var(--muted);
      text-align: center;
    }

    footer a {
      color: var(--accent-soft);
      text-decoration: underline;
      text-decoration-thickness: 1px;
    }

  </style>
</head>

<body>
  <div class="page">

    <!-- MAIN HEADER -->
    <header class="main-header">
      <div class="brand-block">
        <div class="brand-logo">
          <span>SM</span>
        </div>
        <div class="brand-text">
          <h1>Spectra Media Sounds</h1>
          <h2>Cinema &amp; Dance Audio Loops Shop</h2>
          <p>
            Modern cinema and horror loops for films, contemporary dance, trailers and TikTok ‚Äì
            including Grey's Anatomy style and Stranger Things synth moods. MP3 previews here,
            HD WAV files sent by email after purchase.
          </p>
        </div>
      </div>

      <a href="{{ url_for('cart_page') }}" class="cart-pill" id="cartPill">
        <div class="cart-icon">üõí</div>
        <div class="cart-label">
          <span class="line1">Cart</span>
          <span class="line2"><span id="cartCountText">0 loops selected</span></span>
        </div>
        <div class="cart-count-badge" id="cartCountBadge">0</div>
      </a>
    </header>

    <!-- HERO GRID -->
    <section class="hero-grid">

      <div class="hero-main">
        <h3>Curated packs for filmmakers &amp; choreographers</h3>
        <h4>Preview everything in MP3 ‚Äì receive HD WAV in your inbox.</h4>

        <p>
          Explore horror, cinema, drama, Grey's Anatomy style and Stranger Things synth atmospheres,
          crafted for films, stage pieces and social content. You can buy single loops or grab the full collection.
        </p>

        <div class="hero-tags-row">
          <div class="hero-tag">
            <span class="dot"></span>
            <span><strong>48kHz WAV delivery</strong> by email</span>
          </div>
          <div class="hero-tag">
            üé¨ <span>Designed for cinema, dance, trailers &amp; series</span>
          </div>
          <div class="hero-tag">
            üéß <span>MP3 previews ‚Äì one loop at a time</span>
          </div>
          <div class="hero-tag">
            ‚úÖ <span><strong>Royalty-free</strong> usage (see <a href="{{ url_for('about_page') }}">About</a>)</span>
          </div>
        </div>
      </div>

      <div class="hero-pack">
        <h3>Get the complete Cinema, Dance &amp; Horror collection</h3>
        <p>
          All Horror, Cinema, Drama, Grey's Anatomy style and Stranger Things synth loops combined in one bundle.
          Perfect if you want the full palette for your next film, choreography or TikTok series.
        </p>

        <div class="price-line">
          <span>99‚Ç¨</span>
          <span class="label">Full pack ‚Äì lifetime usage</span>
        </div>

        <button class="full-pack-btn" id="fullPackBtn" type="button">
          <span class="icon">‚¨áÔ∏è</span>
          <span>Buy the full pack ‚Äì 99‚Ç¨</span>
        </button>

        <div class="hero-pack-footer">
          You will receive a download email with all HD WAV files after payment.
        </div>
      </div>

    </section>

    <!-- INFO STRIP -->
    <div class="info-strip">
      <div class="info-pill">
        üéß <strong>1‚Ç¨ per loop</strong> ‚Äì simple, transparent pricing
      </div>
      <div class="info-pill">
        ‚úÖ Royalty-free for your projects (see <a href="{{ url_for('about_page') }}">About</a>)
      </div>
      <div class="info-pill">
        üé¨ Cinema, contemporary dance, dramatic series &amp; TikTok
      </div>
    </div>

    <!-- CATEGORY NAV (buttons) -->
    <nav class="category-nav" id="categoryNav">
      <a href="#horror_short" class="category-pill">Horror</a>
      <a href="#horror_long" class="category-pill">Horror ‚Äì Long</a>
      <a href="#cinema_short" class="category-pill">Cinema</a>
      <a href="#cinematic_long" class="category-pill">Cinematic Long</a>
      <a href="#drama_long" class="category-pill">Drama</a>
      <a href="#greys_emotional" class="category-pill">Grey's Anatomy Style</a>
      <a href="#stranger_synth" class="category-pill">Stranger Things Synth</a>
    </nav>

    <!-- ACCORDION -->
    <section class="accordion" id="loopsAccordion">

      {% for category in categories %}
      <article id="{{ category.id }}" class="accordion-item">

        <!-- HEADER -->
        <div class="accordion-header accordion-toggle" data-category-id="{{ category.id }}">
          <div class="accordion-header-left">
            <div class="cat-icon">
              {% if 'horror_long' in category.id %}
                üî•
              {% elif 'horror' in category.id %}
                üëÅÔ∏è
              {% elif 'cinema' in category.id %}
                üé¨
              {% elif 'drama' in category.id %}
                üíî
              {% elif 'greys' in category.id %}
                ü©∫
              {% elif 'stranger' in category.id %}
                üïπÔ∏è
              {% else %}
                üéß
              {% endif %}
            </div>
            <div class="cat-meta">
              <div class="cat-title-line">
                <div class="cat-title">{{ category.title }}</div>
                <div class="cat-tag">
                  {{ category.loops|length }} loops
                </div>
              </div>
              <div class="cat-desc">{{ category.description }}</div>
            </div>
          </div>

          <div class="accordion-header-right">
            <div class="price-chip">
              <span><strong>1‚Ç¨</strong></span>
              <span>/ loop ‚Äì WAV</span>
            </div>
            <div class="accordion-chevron">&#9654;</div>
          </div>
        </div>

        <!-- PANEL -->
        <div class="accordion-panel">
          <div class="panel-inner">
            <div class="loop-list">

              {% for track in category.loops %}
              <div class="loop-item">

                <div class="loop-row-top">
                  <div class="loop-name">
                    {{ track.name }}
                  </div>
                  <div class="loop-meta">
                    <span class="price">1‚Ç¨</span> / WAV<br />
                    <span>MP3 preview ‚Ä¢ 128k</span>
                  </div>
                </div>

                <div class="loop-audio">
                  <audio controls preload="none" data-loop-id="{{ track.id }}">
                    <source src="{{ track.preview }}" type="audio/mpeg" />
                    Your browser does not support HTML5 audio.
                  </audio>
                </div>

                <div class="buy-row">
                  <button class="buy-btn add-to-cart-btn"
                          type="button"
                          data-loop-id="{{ track.id }}">
                    <span class="icon">Ôºã</span>
                    <span>Buy this loop ‚Äì 1‚Ç¨</span>
                  </button>
                </div>

              </div>
              {% endfor %}

            </div>
          </div>
        </div>

      </article>
      {% endfor %}

    </section>

    <!-- FOOTER -->
    <footer>
      <p>
        Spectra Media Sounds ‚Äì cinema &amp; dance audio loops composed and produced by Vincent Bastille.<br />
        After each purchase, you receive <strong>HD WAV download links by email</strong>.
      </p>
      <p>
        Discover the extended universe of Spectra Media:
        <a href="https://group1-6y79.onrender.com/" target="_blank" rel="noopener">Spectra Media AI ‚Äì projects &amp; tools</a>
      </p>
    </footer>

  </div>

  <!-- TOAST -->
  <div id="toast" class="toast">
    <span id="toastMessage">Added to cart</span>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const accordionItems = document.querySelectorAll(".accordion-item");
      const navPills = document.querySelectorAll(".category-pill");
      const toastEl = document.getElementById("toast");
      const toastMsgEl = document.getElementById("toastMessage");
      const cartBadge = document.getElementById("cartCountBadge");
      const cartText = document.getElementById("cartCountText");
      const fullPackBtn = document.getElementById("fullPackBtn");

      // --- AUDIO : only one preview at a time ---
      const audioEls = Array.from(document.querySelectorAll("audio"));
      audioEls.forEach(a => {
        a.addEventListener("play", () => {
          audioEls.forEach(other => {
            if (other !== a) {
              other.pause();
            }
          });
        });
      });

      // --- CART STORAGE HELPERS ---
      const CART_KEY = "spectra_loops_cart";

      function loadCart() {
        try {
          const raw = localStorage.getItem(CART_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) return parsed;
          return [];
        } catch (e) {
          return [];
        }
      }

      function saveCart(ids) {
        localStorage.setItem(CART_KEY, JSON.stringify(ids));
      }

      function updateCartUI() {
        const ids = loadCart();
        const count = ids.length;
        cartBadge.textContent = count;
        cartText.textContent = count === 1 ? "1 loop selected" : count + " loops selected";
      }

      function addToCart(loopId) {
        const ids = loadCart();
        if (!ids.includes(loopId)) {
          ids.push(loopId);
          saveCart(ids);
          updateCartUI();
          showToast("Loop added to cart ‚Äì <span class=\"highlight\">" + ids.length + "</span> selected");
        } else {
          showToast("This loop is already in your cart.");
        }
      }

      // --- TOAST ---
      let toastTimeout = null;

      function showToast(messageHtml) {
        toastMsgEl.innerHTML = messageHtml;
        toastEl.classList.add("show");
        if (toastTimeout) clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
          toastEl.classList.remove("show");
        }, 2600);
      }

      // --- ACCORDION ---
      function openItem(item) {
        accordionItems.forEach(it => {
          const panel = it.querySelector(".accordion-panel");
          if (it === item) {
            it.classList.add("open");
            if (panel) {
              panel.style.maxHeight = panel.scrollHeight + "px";
            }
          } else {
            it.classList.remove("open");
            if (panel) {
              panel.style.maxHeight = 0;
            }
          }
        });
      }

      function activatePillById(catId) {
        navPills.forEach(pill => {
          const href = pill.getAttribute("href") || "";
          if (href === "#" + catId) {
            pill.classList.add("active");
          } else {
            pill.classList.remove("active");
          }
        });
      }

      document.querySelectorAll(".accordion-toggle").forEach(toggle => {
        toggle.addEventListener("click", (e) => {
          const item = e.currentTarget.closest(".accordion-item");
          const isOpen = item.classList.contains("open");
          const catId = item.getAttribute("id");

          if (isOpen) {
            item.classList.remove("open");
            const panel = item.querySelector(".accordion-panel");
            if (panel) {
              panel.style.maxHeight = 0;
            }
          } else {
            openItem(item);
            activatePillById(catId);
            const rect = item.getBoundingClientRect();
            const y = rect.top + window.scrollY - 90;
            window.scrollTo({ top: y, behavior: "smooth" });
          }
        });
      });

      navPills.forEach(pill => {
        pill.addEventListener("click", (e) => {
          e.preventDefault();
          const href = pill.getAttribute("href");
          if (!href || !href.startsWith("#")) return;
          const targetId = href.substring(1);
          const targetItem = document.getElementById(targetId);
          if (targetItem) {
            openItem(targetItem);
            activatePillById(targetId);
            const rect = targetItem.getBoundingClientRect();
            const y = rect.top + window.scrollY - 90;
            window.scrollTo({ top: y, behavior: "smooth" });
          }
        });
      });

      // Open first category by default
      if (accordionItems.length > 0) {
        const first = accordionItems[0];
        openItem(first);
        const firstId = first.getAttribute("id");
        activatePillById(firstId);
      }

      window.addEventListener("resize", () => {
        const openItemEl = document.querySelector(".accordion-item.open");
        if (openItemEl) {
          const panel = openItemEl.querySelector(".accordion-panel");
          if (panel) {
            panel.style.maxHeight = panel.scrollHeight + "px";
          }
        }
      });

      // --- ADD TO CART BUTTONS ---
      document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const loopId = btn.getAttribute("data-loop-id");
          if (!loopId) return;
          addToCart(loopId);
        });
      });

      // --- FULL PACK BUTTON ---
      if (fullPackBtn) {
        fullPackBtn.addEventListener("click", async () => {
          try {
            fullPackBtn.disabled = true;
            fullPackBtn.style.opacity = "0.7";

            const res = await fetch("/create-full-pack-session", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({}),
            });

            const data = await res.json();
            if (data && data.url) {
              window.location.href = data.url;
            } else {
              showToast("Unable to start checkout. Please try again.");
            }
          } catch (err) {
            showToast("Stripe error ‚Äì please try again.");
          } finally {
            fullPackBtn.disabled = false;
            fullPackBtn.style.opacity = "1";
          }
        });
      }

      // Init cart UI on load
      updateCartUI();
    });
  </script>

</body>
</html>
